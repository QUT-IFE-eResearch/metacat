<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
<a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 27 Apr 2008 Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="Util.js Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 27 Apr 2008</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>Util.js</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		No overview generated for 'Util.js'<BR/><BR/>
	
</p>

<hr>


    <table border="1" cellpadding="3" cellspacing="0" width="100%">
    <tr bgcolor="#CCCCFF" class="TableHeadingColor">
    <td colspan=2><font size="+2">
    
        <b>Class Summary</b>
    
    </font></td>
    </tr>
    
    <tr bgcolor="white" class="TableRowColor">
    <td width="15%"><b><a href="XslProcessor.html">XslProcessor</a></b></td>
    <td>&nbsp;</td>
    </tr>
    
    </table>
    <hr/> 


<!-- ========== METHOD SUMMARY =========== -->

	<a name="method_summary"><!-- --></a>
	<table border="1" cellpadding="3" cellspacing="0" width="100%">
		<tr bgcolor="#CCCCFF" class="TableHeadingColor">
			<td colspan=2>
				<font size="+2">
					<b>Method Summary</b>
				</font>
			</td>
		</tr>
	
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#addEvent">addEvent</a></b>(elementObject, eventName, functionObject)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 attach an event to an element.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#debug">debug</a></b>(output)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 write debugging info to a textbox onscreen.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getAbsPos">getAbsPos</a></b>(elt,which)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 TBD: Comment me.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getAbsX">getAbsX</a></b>(elt)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getAbsY">getAbsY</a></b>(elt)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 get the absolute position of HTML element NS4, IE4/5 & NS6, even if it's in a table.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getArgs">getArgs</a></b>()
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 parse comma-separated name=value argument pairs from the query string of the URL; the function stores name=value pairs in properties of an object and returns that object.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getGeoCoordX">getGeoCoordX</a></b>(context, xCooord)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 convert screen x coordinate to geographic coordinate.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getGeoCoordY">getGeoCoordY</a></b>(yCoord)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 convert screen coordinate to screen coordinate.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getNodeValue">getNodeValue</a></b>(sResult)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 getNodevalue return value of node
 it as OpenLayers style
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getPageX">getPageX</a></b>(e)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 get the absolute position of a user event (e.g., a mousedown).
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getPageY">getPageY</a></b>(e)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 get the absolute position of a user event (e.g., a mousedown).
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getProxyPlusUrl">getProxyPlusUrl</a></b>(url)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 If URL is local, then return URL unchanged,
 else return URL of http://proxy?url=URL , or null if proxy not defined.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getScreenX">getScreenX</a></b>(context, xCoord)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 convert geographic x coordinate to screen coordinate.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#getScreenY">getScreenY</a></b>(context, yCoord)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 convert geographic y coordinate to screen coordinate.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#handleEventWithObject">handleEventWithObject</a></b>(evt)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 handle event attached to an object.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#loadCss">loadCss</a></b>(cssFileName)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Dynamically loads a stylesheet into the html page.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#makeElt">makeElt</a></b>(type)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 create an element and append it to the document body element.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#mbDebugMessage">mbDebugMessage</a></b>(object, message)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Show a message if the debug property of the object has been set.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#mbFormatMessage">mbFormatMessage</a></b>(messageFormat)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Format a message with the extra arguments.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#mbGetMessage">mbGetMessage</a></b>(messageKey)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Get a message from the <code>widgetText</code> file and format it if extra
 arguments are passed.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#openPopup">openPopup</a></b>(url, width, height)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 open a popup window, adapted from http://www.quirksmode.org/js/croswin.html
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#postGetLoad">postGetLoad</a></b>(sUri, docToSend, contentType , dir, fileName)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 A more flexible interface for loading docs that allows POST et GET param for save model
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#postLoad">postLoad</a></b>(sUri, docToSend, contentType )
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 A more flexible interface for loading docs that allows POST and async loading
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#returnTarget">returnTarget</a></b>(evt)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 determine and return the target element of an event.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#sld2OlStyle">sld2OlStyle</a></b>(node)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 extract a style from a SLD node of an XML doc and return
 it as OpenLayers style
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#sld2UrlParam">sld2UrlParam</a></b>(node)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 extract a style from a SLD node of an XML doc and return
 it as url parameter for a WMS request
		      </td>
		   </tr>
		
	
	</table>
    <p>

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview"><span class="comment">/*
License:      LGPL as per: http://www.gnu.org/copyleft/lesser.html
Dependancies: Sarissa

$Id: Util.js 3961 2008-04-01 12:45:02Z ahocevar $
*/</span>
<span class="comment">
// some basic browser detection</span>
var MB_IS_MOZ = (document.implementation &amp;&amp; document.implementation.createDocument)?true:false;

<span class="comment">/**
Transform an XML document using the provided XSL and use the results to build
a web page.
<span class="attrib">@constructor</span>
<span class="attrib">@param</span> xslUrl The URL of an XSL stylesheet.
<span class="attrib">@author</span> Cameron Shorter - Cameron AT Shorter.net
*/</span>
<span class="reserved">function</span> XslProcessor(xslUrl,docNSUri) {
<span class="comment">  // override Sarissa configurations to prefer MSXML3, because</span>
<span class="comment">  // MSXML6 does not work well with IE6SP2</span>
  <span class="reserved">if</span> (!MB_IS_MOZ) {
    _SARISSA_DOM_PROGID = Sarissa.pickRecentProgID([<span class="literal">"Msxml2.DOMDocument.3.0"</span>, <span class="literal">"Msxml2.DOMDocument.6.0"</span>], [[<span class="literal">"SELECT_NODES"</span>, 2],[<span class="literal">"TRANSFORM_NODE"</span>, 2]]);
    _SARISSA_XMLHTTP_PROGID = Sarissa.pickRecentProgID([<span class="literal">"Msxml2.XMLHTTP.3.0"</span>, <span class="literal">"MSXML2.XMLHTTP.6.0"</span>], [[<span class="literal">"XMLHTTP"</span>, 4]]);
    _SARISSA_THREADEDDOM_PROGID = Sarissa.pickRecentProgID([<span class="literal">"Msxml2.FreeThreadedDOMDocument.3.0"</span>, <span class="literal">"MSXML2.FreeThreadedDOMDocument.6.0"</span>]);
    _SARISSA_XSLTEMPLATE_PROGID = Sarissa.pickRecentProgID([<span class="literal">"Msxml2.XSLTemplate.3.0"</span>, <span class="literal">"MSXML2.XSLTemplate.6.0"</span>], [[<span class="literal">"XSLTPROC"</span>, 2]]);
  }
<span class="comment">  // get the stylesheet document</span>
  <span class="reserved">this</span>.xslUrl=xslUrl;
  <span class="reserved">this</span>.xslDom = Sarissa.getDomDocument();
  <span class="reserved">this</span>.xslDom.async = false;
<span class="comment">  // fix some issues in IE</span>
  <span class="reserved">if</span> (!MB_IS_MOZ) {
    try {
<span class="comment">      // IE6 SP2 parsing bug</span>
      <span class="reserved">this</span>.xslDom.validateOnParse=false;
<span class="comment">      // Prevent "Access denied" with external documents</span>
      <span class="reserved">this</span>.xslDom.setProperty(<span class="literal">"AllowDocumentFunction"</span>, true);
      <span class="reserved">this</span>.xslDom.resolveExternals = true;
    }
    catch (e) {
<span class="comment">      // do nothing here, we won't get far anyway.</span>
    }
  }
  <span class="reserved">if</span>(typeof(inlineXSL)!=<span class="literal">"undefined"</span>) {
    xmlString = inlineXSL[_1];
    xmlString = xmlString.replace(/DOUBLE_QUOTE/g,<span class="literal">"\"</span><span class="literal">");
    this.xslDom = (new DOMParser()).parseFromString(xmlString, "</span>text/xml<span class="literal">");
  }
  else {
    if(_SARISSA_IS_SAFARI){
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("</span>GET<span class="literal">", xslUrl, false);
        xmlhttp.send(null);
        this.xslDom = xmlhttp.responseXML;
    }else
    {
      this.xslDom.load(xslUrl);
    }
  }
  if ( Sarissa.getParseErrorText(this.xslDom) != Sarissa.PARSED_OK )
    alert(mbGetMessage("</span>errorLoadingStylesheet<span class="literal">", xslUrl));

  this.processor = new XSLTProcessor();
  this.processor.importStylesheet(this.xslDom);
  
  this.docNSUri = docNSUri;

  /**
   * Transforms XML in the provided xml node according to this XSL.
   * @param xmlNode The XML node to be transformed.
   * @return The transformed String.
   */
  this.transformNodeToString = function(xmlNode) {
    try {
      // transform and build a web page with result
      //MAP-427 Quick hack to transform an XMLElement to XMLDocument in IE
     
      if (_SARISSA_IS_IE){
	      var str = (new XMLSerializer()).serializeToString(xmlNode);
	      var xmlNode = (new DOMParser()).parseFromString(str, "</span>text/xml<span class="literal">");
	  }
      var newDoc = this.transformNodeToObject(xmlNode);
      var s = (new XMLSerializer()).serializeToString(newDoc);
      if(_SARISSA_IS_OPERA)
      	s =  s.replace(/.*\?\&gt;/,"</span><span class="literal">");//hack for opera to delete &lt;?xml ... ?&gt;
      return s;
    } catch(e){
      alert(mbGetMessage("</span>exceptionTransformingDoc<span class="literal">", this.xslUrl));
      alert("</span>XSL=<span class="literal">"+(new XMLSerializer()).serializeToString(this.xslDom));
      alert("</span>XML=<span class="literal">"+(new XMLSerializer()).serializeToString(xmlNode));
    }
  }

  /**
   * Transforms XML in the provided xml node according to this XSL.
   * @param xmlNode The XML node to be transformed.
   * @return a DOM document object
   */
  this.transformNodeToObject=function(xmlNode) {
    if(_SARISSA_IS_SAFARI){
      var oResult = new DOMParser().parseFromString("</span>&lt;xsltresult&gt;&lt;/xsltresult&gt;<span class="literal">", "</span>text/xml<span class="literal">");
      var newFragment = this.processor.transformToFragment(xmlNode, oResult);
      var str = (new XMLSerializer()).serializeToString(newFragment);
      str.replace(/\s/g,"</span><span class="literal">");
    }else{
       var newFragment = this.processor.transformToDocument(xmlNode);
    }
    return newFragment;
  }

  /**
   * Set XSL parameter.
   */
  this.setParameter=function(paramName, paramValue, nsUri) {
    //if ( typeof paramValue == "</span>string<span class="literal">" || typeof paramValue == "</span>number<span class="literal">") paramValue="</span><span class="literal">'"+paramValue+"'</span><span class="literal">";
    if (!paramValue) {
      //alert("</span>null value <span class="reserved">for</span> stylesheet param:<span class="literal">"+paramName+"</span>:<span class="literal">"+paramValue);
      return;
    }
    this.processor.setParameter( null, paramName, paramValue);
  }
}

/**
 * A more flexible interface for loading docs that allows POST and async loading
 */
function postLoad(sUri, docToSend, contentType ) {
   var xmlHttp = new XMLHttpRequest();
   if ( sUri.indexOf("</span>http://<span class="literal">")==0 || sUri.indexOf("</span>https://<span class="literal">")==0 ) {
     xmlHttp.open("</span>POST<span class="literal">", config.proxyUrl, false);
     xmlHttp.setRequestHeader("</span>serverUrl<span class="literal">",sUri);//escape(sUri).replace(/\+/g, '%2C').replace(/\"</span>/g,<span class="literal">'%22'</span>).replace(/\<span class="literal">'/g, '</span>%27<span class="literal">'));
   } else {
     xmlHttp.open("POST", sUri, false);
   }
   xmlHttp.setRequestHeader("content-type","text/xml");
   if (contentType) xmlHttp.setRequestHeader("content-type",contentType);
   //alert("sending:"+docToSend.xml);
   xmlHttp.send( docToSend );
/*
   if (_SARISSA_IS_IE) {
alert("before");
    xmlHttp.status = xmlHttp.Status;
alert("after");
    xmlHttp.statusText = xmlHttp.StatusText;
    xmlHttp.responseText = xmlHttp.ResponseText;
   }
*/
   if (xmlHttp.status &gt;= 400) {   //http errors status start at 400
      alert(mbGetMessage("errorLoadingDocument", sUri, xmlHttp.statusText, xmlHttp.responseText));
      var outDoc = Sarissa.getDomDocument();
      outDoc.parseError = -1;
      return outDoc;
   } else {
     //alert(xmlHttp.getResponseHeader("Content-Type"));
     if ( null==xmlHttp.responseXML ) alert(mbGetMessage("nullXmlResponse", xmlHttp.responseText));
     return xmlHttp.responseXML;
   }
}


/**
 * A more flexible interface for loading docs that allows POST et GET param for save model
 */

function postGetLoad(sUri, docToSend, contentType , dir, fileName) {

   var xmlHttp = new XMLHttpRequest();
   var appendChar = sUri.indexOf("?") == -1 ? "?" : "&amp;";
   if(dir &amp;&amp; fileName)
       	sUri=sUri+appendChar+"dir="+dir+"&amp;fileName="+fileName;
   else if(dir)
   		sUri=sUri+appendChar+"dir="+dir;
   else if(fileName)
   		sUri=sUri+appendChar+"fileName="+fileName;
   		
   if ( sUri.indexOf("http://")==0 || sUri.indexOf("https://")==0 )
   {
       xmlHttp.open("POST", config.proxyUrl, false);       
       xmlHttp.setRequestHeader("serverUrl",sUri);
   }
   else
   {
       xmlHttp.open("POST", sUri, false);
   }
   xmlHttp.setRequestHeader("content-type","text/xml");
   if (contentType) xmlHttp.setRequestHeader("content-type",contentType);
   xmlHttp.send( docToSend );

   if (xmlHttp.status &gt;= 400)
   {   //http errors status start at 400
        alert(mbGetMessage("errorLoadingDocument", sUri, xmlHttp.statusText, xmlHttp.responseText));
        var outDoc = Sarissa.getDomDocument();
        outDoc.parseError = -1;
        return outDoc;
   }
   else
   {
       if ( null==xmlHttp.responseXML ) alert(mbGetMessage("nullXmlResponse", xmlHttp.responseText));
       return xmlHttp.responseXML;
   }
}



  /**
   * If URL is local, then return URL unchanged,
   * else return URL of http://proxy?url=URL , or null if proxy not defined.
   * @param url Url of the file to access.
   * @return Url of the proxy and service in the form http://host/proxy?url=service
   */
function getProxyPlusUrl(url) {
  if ( url.indexOf("http://")==0 || url.indexOf("https://")==0 ) {
    if ( config.proxyUrl ) {
      url=config.proxyUrl+"?url="+escape(url).replace(/\+/g, '</span>%2C<span class="literal">').replace(/\"/g,'</span>%22<span class="literal">').replace(/\'</span>/g, <span class="literal">'%27'</span>);
    } <span class="reserved">else</span> {
      alert(mbGetMessage(<span class="literal">"unableToLoadDoc"</span>, url));
      url=null;
    }
  }
  <span class="reserved">return</span> url;
}

  <span class="comment">/**
   * Browser independant version of createElementNS()
   * <span class="attrib">@param</span> doc the owner document for the new element
   * <span class="attrib">@param</span> name for the new element
   * <span class="attrib">@param</span> ns the URL for the namespace (without a prefix)
   * <span class="attrib">@return</span> element in the document with the specified namespace
   */</span>
<span class="reserved">function</span> createElementWithNS(doc,name,nsUri) {
  <span class="reserved">if</span> (_SARISSA_IS_IE) {
    <span class="reserved">return</span> doc.createNode(1, name, nsUri);
  } <span class="reserved">else</span> {
    <span class="reserved">return</span> doc.createElementNS(nsUri,name);
  }
}

<span class="comment">/**
 * Create a unique Id which can be used for classes to link themselves to HTML
 * Ids.
 * <span class="attrib">@constructor</span>
 */</span>
<span class="reserved">function</span> UniqueId(){
  <span class="reserved">this</span>.lastId=0;

  <span class="comment">/** Return a numeric unique Id. */</span>
  <span class="reserved">this</span>.getId=<span class="reserved">function</span>() {
    <span class="reserved">this</span>.lastId++;
    <span class="reserved">return</span> <span class="reserved">this</span>.lastId;
  }
}
<span class="comment">//use this global object to generate a unique ID via the getId function</span>
var mbIds = new UniqueId();

<span class="reserved">function</span> setISODate(isoDateStr) {
  var parts = isoDateStr.match(/(\d{4})-?(\d{2})?-?(\d{2})?T?(\d{2})?:?(\d{2})?:?(\d{2})?\.?(\d{0,3})?(Z)?/);
  var res = null;
  <span class="reserved">for</span> (var i=1;i&lt;parts.length;++i){
    <span class="reserved">if</span> (!parts[i]) {
      parts[i] = (i==3)?1:0; //months start with day number 1, not 0
      <span class="reserved">if</span> (!res) res = i;
    }
  }
  var isoDate = new Date();
  isoDate.setFullYear(parseInt(parts[1],10));
  isoDate.setMonth(parseInt(parts[2],10)-1,parseInt(parts[3],10));
  isoDate.setDate(parseInt(parts[3],10));
  isoDate.setHours(parseInt(parts[4],10));
  isoDate.setMinutes(parseInt(parts[5],10));
  isoDate.setSeconds(parseFloat(parts[6],10));
  <span class="reserved">if</span> (!res) res = 6;
  isoDate.res = res;
  <span class="reserved">return</span> isoDate;
}

<span class="reserved">function</span> getISODate(isoDate) {
  var res = isoDate.res?isoDate.res:6;
  var dateStr = <span class="literal">""</span>;
  dateStr += res&gt;=1?isoDate.getFullYear():<span class="literal">""</span>;
  dateStr += res&gt;=2?<span class="literal">"-"</span>+leadingZeros(isoDate.getMonth()+1,2):<span class="literal">""</span>;
  dateStr += res&gt;=3?<span class="literal">"-"</span>+leadingZeros(isoDate.getDate(),2):<span class="literal">""</span>;
  dateStr += res&gt;=4?<span class="literal">"T"</span>+leadingZeros(isoDate.getHours(),2):<span class="literal">""</span>;
  dateStr += res&gt;=5?<span class="literal">":"</span>+leadingZeros(isoDate.getMinutes(),2):<span class="literal">""</span>;
  dateStr += res&gt;=6?<span class="literal">":"</span>+leadingZeros(isoDate.getSeconds(),2):<span class="literal">""</span>;
  <span class="reserved">return</span> dateStr;
}

<span class="reserved">function</span> leadingZeros(num,digits) {
  var intNum = parseInt(num,10);
  var base = Math.pow(10,digits);
  <span class="reserved">if</span> (intNum&lt;base) intNum += base;
  <span class="reserved">return</span> intNum.toString().substr(1);
}
<span class="comment">

// Correctly handle PNG transparency in Win IE 5.5 or higher.</span>
<span class="comment">// this method should be set as an IMG onload handler for PNG map layers</span>
<span class="comment">// thanks to Caroklyn Cole for this fix.  For an explanation see:</span>
<span class="comment">// http://homepage.ntlworld.com/bobosola. Updated 02-March-2004</span>
<span class="comment">// modified to the images as visible after this has been called.</span>
<span class="comment">// PL-BRGM</span>
<span class="comment">// Add oldImage in parameter</span>
<span class="reserved">function</span> fixPNG(myImage,myId,oldImage) {
  <span class="reserved">if</span> (_SARISSA_IS_IE) {
<span class="comment">    // PL - BRGM</span>
<span class="comment">    //opacity of the image</span>
    <span class="reserved">if</span>(oldImage) {
      var valIEOpacity= oldImage.style.filter.substring(oldImage.style.filter.indexOf(<span class="literal">'opacity='</span>,0)+8,oldImage.style.filter.lastIndexOf(<span class="literal">')'</span>,0));
      <span class="reserved">if</span>(oldImage.style.filter.indexOf(<span class="literal">'opacity='</span>,0) ==-1){
        valIEOpacity = null;
      }
       var _opacity= (valIEOpacity)?valIEOpacity/100:-1;
     }
<span class="comment">  // END</span>
    var imgID = <span class="literal">"id='"</span> + myId + <span class="literal">"' "</span>;
    var imgClass = (myImage.className) ? <span class="literal">"class='"</span> + myImage.className + <span class="literal">"' "</span> : <span class="literal">""</span>
    var imgTitle = (myImage.title) ? <span class="literal">"title='"</span> + myImage.title + <span class="literal">"' "</span> : <span class="literal">"title='"</span> + myImage.alt + <span class="literal">"' "</span>
    var imgStyle = <span class="literal">"display:inline-block;"</span> + myImage.style.cssText
    var strNewHTML = <span class="literal">"&lt;span "</span> + imgID + imgClass + imgTitle

    strNewHTML += <span class="literal">" style=\"</span><span class="literal">" + "</span>width:<span class="literal">" + myImage.width + "</span>px; height:<span class="literal">" + myImage.height + "</span>px;<span class="literal">" + imgStyle + "</span>;<span class="literal">"
    // store the opacity in the style even not used by IE
    if (_opacity!=-1) strNewHTML += "</span>opacity=<span class="literal">" + _opacity + "</span>;<span class="literal">" ;
    // Escape some chars (don't use encode() that would escape %xx previously used in XSL)
    var src = myImage.src;
    src = src.replace(/\(/g,'%28');
    src = src.replace(/\)/g,'%29');
    src = src.replace(/'/g,'%27');
    // AlphaImageLoader converts '%23' in src to '#' and cuts URL on '#'
    src = src.replace(/%23/g,'%2523');
    strNewHTML += "</span>filter:progid:DXImageTransform.Microsoft.AlphaImageLoader<span class="literal">";
    strNewHTML += "</span>(src=\<span class="literal">'" + src + "\'</span>, sizingMethod=<span class="literal">'scale'</span>)<span class="literal">";

    // PL - BRGM
    // add the opacity
    if (oldImage &amp;&amp; _opacity!=-1) strNewHTML +=  "</span> alpha(opacity=<span class="literal">" + (_opacity * 100) + "</span>)<span class="literal">";
    strNewHTML +="</span>; \<span class="literal">"&gt;&lt;/span&gt;"</span> ;
<span class="comment">  // END PL - BRGM</span>
<span class="comment">    //myImage.outerHTML = strNewHTML;</span>
<span class="comment">    //alert(strNewHTML);</span>
    <span class="reserved">return</span> strNewHTML;
  }
}



<span class="comment">/**
 * get the absolute position of HTML element NS4, IE4/5 &amp; NS6, even if it's in a table.
 * <span class="attrib">@param</span> element The HTML element.
 * <span class="attrib">@return</span> Top left X position.
 */</span>
<span class="reserved">function</span> getAbsX(elt) {
        <span class="reserved">return</span> (elt.x) ? elt.x : getAbsPos(elt,<span class="literal">"Left"</span>) + 2;
}

<span class="comment">/**
 * get the absolute position of HTML element NS4, IE4/5 &amp; NS6, even if it's in a table.
 * <span class="attrib">@param</span> element The HTML element.
 * <span class="attrib">@return</span> Top left Y position.
 */</span>
<span class="reserved">function</span> getAbsY(elt) {
        <span class="reserved">return</span> (elt.y) ? elt.y : getAbsPos(elt,<span class="literal">"Top"</span>) + 2;
}

<span class="comment">/**
 * TBD: Comment me.
 * <span class="attrib">@param</span> elt TBD
 * <span class="attrib">@param</span> which TBD
 */</span>
<span class="reserved">function</span> getAbsPos(elt,which) {
 iPos = 0;
 <span class="reserved">while</span> (elt != null) {
        iPos += elt[<span class="literal">"offset"</span> + which];
        elt = elt.offsetParent;
 }
 <span class="reserved">return</span> iPos;
}

<span class="comment">/**
 * get the absolute position of a user event (e.g., a mousedown).
 * <span class="attrib">@param</span> e The user event.
 * <span class="attrib">@return</span> Left or top position.
 */</span>
<span class="reserved">function</span> getPageX(e){
  var posx = 0;
  <span class="reserved">if</span> (!e) var e = window.event;
  <span class="reserved">if</span> (e.pageX) {
    posx = e.pageX;
  }
  <span class="reserved">else</span> <span class="reserved">if</span> (e.clientX) {
   posx = e.clientX;
  }
  <span class="reserved">if</span> (document.body &amp;&amp; document.body.scrollLeft){
    posx += document.body.scrollLeft;
  }
  <span class="reserved">else</span> <span class="reserved">if</span> (document.documentElement &amp;&amp; document.documentElement.scrollLeft){
    posx += document.documentElement.scrollLeft;
  }
  <span class="reserved">return</span> posx;
}

<span class="comment">/**
 * get the absolute position of a user event (e.g., a mousedown).
 * <span class="attrib">@param</span> e The user event.
 * <span class="attrib">@return</span> Left or top position.
 */</span>
<span class="reserved">function</span> getPageY(e){
  var posy = 0;
  <span class="reserved">if</span> (!e) var e = window.event;
  <span class="reserved">if</span> (e.pageY) {
    posy = e.pageY;
  }
  <span class="reserved">else</span> <span class="reserved">if</span> (e.clientY) {
    posy = e.clientY;
  }
  <span class="reserved">if</span> (document.body &amp;&amp; document.body.scrollTop){
    posy += document.body.scrollTop;
  }
  <span class="reserved">else</span> <span class="reserved">if</span> (document.documentElement &amp;&amp; document.documentElement.scrollTop){
    posy += document.documentElement.scrollTop;
  }
  <span class="reserved">return</span> posy;
}

<span class="comment">/**
 * parse comma-separated name=value argument pairs from the query string of the URL; the function stores name=value pairs in properties of an object and returns that object.
 * <span class="attrib">@return</span> args Array of arguments passed to page, in form args[argname] = value.
 */</span>
<span class="reserved">function</span> getArgs(){
  var args = new Object();
  var query = location.search.substring(1);
  var pairs = query.split(<span class="literal">"&amp;"</span>);
  <span class="reserved">for</span>(var i = 0; i &lt; pairs.length; i++) {
    var pos = pairs[i].indexOf(<span class="literal">'='</span>);
    <span class="reserved">if</span> (pos == -1) continue;
    var argname = pairs[i].substring(0,pos);
    var value = pairs[i].substring(pos+1);
    args[argname] = unescape(value.replace(/\+/g, <span class="literal">" "</span>));
  }
  <span class="reserved">return</span> args;
}
<span class="comment">//initialize the array once</span>
window.cgiArgs = getArgs();

<span class="comment">/**
 * convert geographic x coordinate to screen coordinate.
 * <span class="attrib">@param</span> context The context object.
 * <span class="attrib">@param</span> xCoord The geographic x coordinate to be converted.
 * <span class="attrib">@return</span> x the converted x coordinate.
 */</span>
<span class="reserved">function</span> getScreenX(context, xCoord){
  bbox=context.getBoundingBox();
  width=context.getWindowWidth();
  bbox[0]=parseFloat(bbox[0]);
  bbox[2]=parseFloat(bbox[2]);
  var xfac = (width/(bbox[2]-bbox[0]));
  x=xfac*(xCoord-bbox[0]);
  <span class="reserved">return</span> x;
}

<span class="comment">/**
 * convert geographic y coordinate to screen coordinate.
 * <span class="attrib">@param</span> context The context object.
 * <span class="attrib">@param</span> yCoord The geographic x coordinate to be converted.
 * <span class="attrib">@return</span> y the converted x coordinate.
 */</span>
<span class="reserved">function</span> getScreenY(context, yCoord){
  var bbox=context.getBoundingBox();
  var height=context.getWindowHeight();
  bbox[1]=parseFloat(bbox[1]);
  bbox[3]=parseFloat(bbox[3]);
  var yfac = (heighteight/(bbox[3]-bbox[1]));
  var y=height-(yfac*(pt.y-bbox[1]));
  <span class="reserved">return</span> y;
}

<span class="comment">/**
 * convert screen x coordinate to geographic coordinate.
 * <span class="attrib">@param</span> context The context object.
 * <span class="attrib">@param</span> xCoord The screen x coordinate to be converted.
 * <span class="attrib">@return</span> x the converted x coordinate.
 */</span>
<span class="reserved">function</span> getGeoCoordX(context, xCooord) {
  var bbox=context.getBoundingBox();
  var width=context.getWindowWidth();
  bbox[0]=parseFloat(bbox[0]);
  bbox[2]=parseFloat(bbox[2]);
  var xfac = ((bbox[2]-bbox[0]) / width);
  var x=bbox[0] + xfac*(xCoord);
  <span class="reserved">return</span> x;
}

<span class="comment">/**
 * convert screen coordinate to screen coordinate.
 * <span class="attrib">@param</span> context The context object.
 * <span class="attrib">@param</span> yCoord The geographic y coordinate to be converted.
 * <span class="attrib">@return</span> y the converted y coordinate.
 */</span>
<span class="reserved">function</span> getGeoCoordY(yCoord){
  var bbox=context.getBoundingBox();
  var height=context.getWindowHeight();
  bbox[1]=parseFloat(bbox[1]);
  bbox[3]=parseFloat(bbox[3]);
  var yfac = ((bbox[3]-bbox[1]) / height);
  var y=bbox[1] + yfac*(height-yCoord);
  <span class="reserved">return</span> y;
}

<span class="comment">/**
 * create an element and append it to the document body element.
 * <span class="attrib">@param</span> type The type of element to be created.
 * <span class="attrib">@return</span> node The node created and appended.
 */</span>
<span class="reserved">function</span> makeElt(type) {
  var node=document.createElement(type);
  document.getElementsByTagName(<span class="literal">"body"</span>).item(0).appendChild(node);
  <span class="reserved">return</span> node;
}
<span class="comment">
// variable needed to determine if a popup window is currently open</span>
var newWindow = <span class="literal">''</span>;
<span class="comment">/**
 * open a popup window, adapted from http://www.quirksmode.org/js/croswin.html
 * <span class="attrib">@param</span> url The url of the page to be opened.
 * <span class="attrib">@param</span> width Width of the popup window, in pixels.
 * <span class="attrib">@param</span> height Height of the popup window, in pixels.
 */</span>
<span class="reserved">function</span> openPopup(url, width, height) {
  <span class="reserved">if</span>(width == null) {
    width = 300;
  }
  <span class="reserved">if</span>(height == null) {
    height = 200;
  }
  <span class="reserved">if</span> (!newWindow.closed &amp;&amp; newWindow.location) {
    newWindow.location.href = url;
  }
  <span class="reserved">else</span> {
    newWindow=window.open(url,<span class="literal">'name'</span>,<span class="literal">'height='</span> + height + <span class="literal">',width='</span> + width);
    <span class="reserved">if</span> (!newWindow.opener) newwindow.opener = self;
  }
  <span class="reserved">if</span> (window.focus) {newWindow.focus()}
  <span class="reserved">return</span> false;
}

<span class="comment">/**
 * write debugging info to a textbox onscreen.
 * <span class="attrib">@param</span> output String to be output.
 */</span>
<span class="reserved">function</span> debug(output){
  tarea=makeElt(<span class="literal">"textarea"</span>);
  tarea.setAttribute(<span class="literal">"rows"</span>,<span class="literal">"3"</span>);
  tarea.setAttribute(<span class="literal">"cols"</span>,<span class="literal">"40"</span>);
  tnode=document.createTextNode(output);
  tarea.appendChild(tnode);
}

<span class="comment">/**
 * determine and return the target element of an event.
 * <span class="attrib">@param</span> evt The event.
 * <span class="attrib">@return</span> elt The element.
 */</span>
<span class="reserved">function</span> returnTarget(evt){
  evt = (evt) ? evt : ((window.event) ? window.event : <span class="literal">""</span>);
  var elt=null;
  <span class="reserved">if</span>(evt.target){
    elt=evt.target;
  }
  <span class="reserved">else</span> <span class="reserved">if</span>(evt.srcElement){
    elt=evt.srcElement;
  }
  <span class="reserved">return</span> elt;
}

<span class="comment">/**
 * attach an event to an element.
 * <span class="attrib">@param</span> elementObject The object.
 * <span class="attrib">@param</span> eventName The name of the event.
 * <span class="attrib">@param</span> functionObject The function to be called.
 */</span>
<span class="reserved">function</span> addEvent(elementObject, eventName, functionObject) {
  <span class="reserved">if</span>(document.addEventListener) {
    elementObject.addEventListener(eventName, functionObject, false);
  }
  <span class="reserved">else</span> <span class="reserved">if</span>(document.attachEvent) {
    elementObject.attachEvent(<span class="literal">"on"</span> + eventName, functionObject);
  }
}

<span class="comment">/**
 * handle event attached to an object.
 * <span class="attrib">@param</span> evt The event.
 */</span>
<span class="reserved">function</span> handleEventWithObject(evt){
  var elt = returnTarget(evt);
  var obj = elt.ownerObj;
  <span class="reserved">if</span> (obj!=null) obj.handleEvent(evt);
}

<span class="comment">/**
 * Show a message if the debug property of the object has been set.
 * <span class="attrib">@param</span> object  the object that possibly has the debug property set
 * <span class="attrib">@param</span> message the message to show
 */</span>
<span class="reserved">function</span> mbDebugMessage(object, message)
{
  <span class="reserved">if</span> (object &amp;&amp; object.debug) {
    alert(message);
  }
}

<span class="comment">/**
 * Get a message from the &lt;code&gt;widgetText&lt;/code&gt; file and format it if extra
 * arguments are passed.
 * <span class="attrib">@param</span> messageKey       the message key within the message node
 * <span class="attrib">@param</span> varArgs          optional extra parameters for formatting the message
 * <span class="attrib">@return</span>                 &lt;code&gt;"NoMsgsFound"&lt;/code&gt; if the &lt;code&gt;widgetText&lt;/code&gt; file is not found,&lt;br/&gt;
 *                         the &lt;code&gt;messageKey&lt;/code&gt; if the message key was not found within the message node,&lt;br/&gt;
 *                         the (formatted) message if it was found
 */</span>
<span class="reserved">function</span> mbGetMessage(messageKey)
{
  var message = <span class="literal">"NoMsgsFound"</span>;
  <span class="reserved">if</span> (config.widgetText) {
    var msgKeyXpath = <span class="literal">"/mb:WidgetText/mb:messages/mb:"</span> + messageKey;
    var msgKeyNodes = config.widgetText.selectNodes(msgKeyXpath);
    <span class="reserved">if</span> (!msgKeyNodes || msgKeyNodes.length == 0) {
<span class="comment">      // Message not found, fall back to message key</span>
      message = messageKey;
    }
    <span class="reserved">else</span> {
<span class="comment">      // Message found; pick last one so user can override messages</span>
      message = getNodeValue(msgKeyNodes.item(msgKeyNodes.length-1));
      <span class="reserved">if</span> (arguments[mbGetMessage.length]) {
<span class="comment">        // Extra arguments, format message</span>
        var varArgs = [].slice.call(arguments, mbGetMessage.length);
        varArgs.unshift(message);
        message = mbFormatMessage.apply(<span class="reserved">this</span>, varArgs);
      }
    }
  }
  <span class="reserved">return</span> message;
}

<span class="comment">/**
 * Format a message with the extra arguments. &lt;br/&gt;
 * E.g. if called as: &lt;code&gt;mbFormatMessage("{1} is {0} {2}, {1}", "a good", "this", "test")&lt;/code&gt;&lt;br/&gt;
 * the formatted message returned is: &lt;code&gt;"this is a good test, this"&lt;/code&gt;
 * <span class="attrib">@param</span> messageFormat the message format string
 * <span class="attrib">@param</span> varArgs       optional extra parameters for formatting the message
 * <span class="attrib">@return</span>              the formatted message
 */</span>
<span class="reserved">function</span> mbFormatMessage(messageFormat)
{
  var message = messageFormat;
  var varArgs = [].slice.call(arguments, mbFormatMessage.length);
  <span class="reserved">for</span> (var i=0; i&lt;varArgs.length; i++) {
    var parm = new RegExp(<span class="literal">"\\{"</span> + i + <span class="literal">"\\}"</span>, <span class="literal">"g"</span>);
    message = message.replace(parm, varArgs[i]);
  }
  <span class="reserved">return</span> message;
}

<span class="comment">/**
 * extract a style from a SLD node of an XML doc and return
 * it as url parameter for a WMS request
 * <span class="attrib">@param</span> node XML node containing the styled layer descriptor
 * <span class="attrib">@return</span> WMS-compliant SLD URL parameters as array
 */</span>
<span class="reserved">function</span> sld2UrlParam(node) {
  var params=new Array();
  <span class="reserved">if</span> (node) {
    var sld = node.selectSingleNode(<span class="literal">"wmc:SLD"</span>);
    var name = node.selectSingleNode(<span class="literal">"wmc:Name"</span>);
    <span class="reserved">if</span>(sld) {
      <span class="reserved">if</span>(sld.selectSingleNode(<span class="literal">"wmc:OnlineResource"</span>)) {	
        params.sld=sld.selectSingleNode(<span class="literal">"wmc:OnlineResource"</span>).getAttribute(<span class="literal">"xlink:href"</span>);
      } <span class="reserved">else</span> <span class="reserved">if</span>(sld.selectSingleNode(<span class="literal">"wmc:FeatureTypeStyle"</span>)) {
        params.sld=(new XMLSerializer()).serializeToString(sld.selectSingleNode(<span class="literal">"wmc:FeatureTypeStyle"</span>));
      } <span class="reserved">else</span> <span class="reserved">if</span>(sld.selectSingleNode(<span class="literal">"wmc:StyledLayerDescriptor"</span>)) { 
        params.sld_body=(new XMLSerializer()).serializeToString(sld.selectSingleNode(<span class="literal">"wmc:StyledLayerDescriptor"</span>));    		
      }
    } <span class="reserved">else</span> <span class="reserved">if</span>(name) {
      params.styles = getNodeValue(name) || <span class="literal">""</span>;	
    }
  }  
  <span class="reserved">return</span> params;
}

<span class="comment">/**
 * extract a style from a SLD node of an XML doc and return
 * it as OpenLayers style
 * <span class="attrib">@param</span> objRef reference to the map widget that will use the style
 * <span class="attrib">@param</span> node XML node containing the styled layer descriptor
 * <span class="attrib">@return</span> OpenLayers style object
 */</span>
<span class="reserved">function</span> sld2OlStyle(node) {
<span class="comment">  // OpenLayers SLD parsing</span>
  <span class="reserved">if</span> (node) {
    var ruleNode = node.selectSingleNode(<span class="literal">"wmc:SLD/sld:FeatureTypeStyle"</span>);
    <span class="reserved">if</span> (ruleNode) {
      var sld = new XMLSerializer().serializeToString(ruleNode);
      var search = /&lt;([^:]*:?)StyledLayerDescriptor/;
      <span class="reserved">if</span> (!search.test(sld)) {
      	sld = sld.replace(/&lt;([^:]*:?)FeatureTypeStyle([^&gt;]*)&gt;(.*)$/,
            <span class="literal">"&lt;$1StyledLayerDescriptor$2&gt;&lt;$1NamedLayer&gt;&lt;$1Name&gt;sld&lt;/$1Name&gt;&lt;$1UserStyle&gt;&lt;$1FeatureTypeStyle&gt;$3&lt;/$1UserStyle&gt;&lt;/$1NamedLayer&gt;&lt;/$1StyledLayerDescriptor&gt;"</span>);
      }
    }
    var styles = new OpenLayers.Format.SLD().read(sld);
    <span class="reserved">if</span> (styles) {
      <span class="reserved">return</span> styles.namedLayers[<span class="literal">"sld"</span>].userStyles[0];
    }
  }
<span class="comment">  
  // fallback to native SLD parsing for older OwsContext docs</span>
<span class="comment">  
  // sld-conform default style</span>
  var defaultStyle = {
            fillColor: <span class="literal">"#808080"</span>,
            fillOpacity: 1,
            strokeColor: <span class="literal">"#000000"</span>,
            strokeOpacity: 1,
            strokeWidth: 1,
            pointRadius: 6};
            
  var style1=OpenLayers.Util.extend(defaultStyle,OpenLayers.Feature.Vector.style[<span class="literal">"default"</span>]);
  var value;
  var styleSet=false;

  <span class="reserved">if</span> (node) {
    value=node.selectSingleNode(<span class="literal">".//sld:ExternalGraphic/sld:OnlineResource/@xlink:href"</span>);
    <span class="reserved">if</span>(value){
      style1.externalGraphic=getNodeValue(value);
      styleSet=true;
    }
    value=node.selectSingleNode(<span class="literal">".//sld:Fill/sld:CssParameter[@name='fill']"</span>);
    <span class="reserved">if</span>(value){
      style1.fillColor=getNodeValue(value);
      styleSet=true;
    }
    value=node.selectSingleNode(<span class="literal">".//sld:Fill/sld:CssParameter[@name='fill-opacity']"</span>);
    <span class="reserved">if</span>(value){
      style1.fillOpacity=getNodeValue(value);
      styleSet=true;
    } <span class="reserved">else</span> {
<span class="comment">      // opacity eg. for externalGraphic</span>
      value=node.selectSingleNode(<span class="literal">".//sld:Opacity/sld:Literal"</span>);
      <span class="reserved">if</span> (value){
        style1.fillOpacity=getNodeValue(value);
        styleSet=true;
      }
    }
  
    value=node.selectSingleNode(<span class="literal">".//sld:Stroke/sld:CssParameter[@name='stroke']"</span>);
    <span class="reserved">if</span>(value){
      style1.strokeColor=getNodeValue(value);
      styleSet=true;
    }
    
    value=node.selectSingleNode(<span class="literal">".//sld:Stroke/sld:CssParameter[@name='stroke-opacity']"</span>);
    <span class="reserved">if</span>(value){
      style1.strokeOpacity=getNodeValue(value);
      styleSet=true;
    }
    
    value=node.selectSingleNode(<span class="literal">".//sld:Stroke/sld:CssParameter[@name='stroke-width']"</span>);
    <span class="reserved">if</span>(value){
      style1.strokeWidth=getNodeValue(value);
      styleSet=true;
    }
    
    value=node.selectSingleNode(<span class="literal">".//sld:Size"</span>);
    <span class="reserved">if</span>(value){
      style1.pointRadius=getNodeValue(value);
      styleSet=true;
    }
  }
  
  <span class="reserved">if</span>(!styleSet)style1=null;
  <span class="reserved">return</span> style1;
}

<span class="comment">/**
 * Dynamically loads a stylesheet into the html page.
 * <span class="attrib">@param</span> cssFileName name of the file to load, relative to config.skinDir
 */</span>
<span class="reserved">function</span> loadCss(cssFileName) {
<span class="comment">  // queue the request if we do not know the skinDir yet</span>
  <span class="reserved">if</span> (typeof config == <span class="literal">"undefined"</span> || typeof config.skinDir != <span class="literal">"string"</span>) {
    <span class="reserved">if</span> (!mapbuilder.cssToLoad) {
      mapbuilder.cssToLoad = [];
    }
    mapbuilder.cssToLoad.push(cssFileName);
    <span class="reserved">return</span>;
  }
  
  var id = cssFileName.match(/[^\/]*$/).toString().replace(/./, <span class="literal">'_'</span>);
  <span class="reserved">if</span> (!document.getElementById(id)) {
    var cssNode = document.createElement(<span class="literal">'link'</span>);
    cssNode.setAttribute(<span class="literal">'id'</span>, id);
    cssNode.setAttribute(<span class="literal">'rel'</span>, <span class="literal">'stylesheet'</span>);
    cssNode.setAttribute(<span class="literal">'type'</span>, <span class="literal">'text/css'</span>);
    cssNode.setAttribute(<span class="literal">'href'</span>, config.skinDir+<span class="literal">'/'</span>+cssFileName);
    document.getElementsByTagName(<span class="literal">'head'</span>)[0].appendChild(cssNode);
  }
}

<span class="comment">/**
 * getNodevalue return value of node
 * it as OpenLayers style
 * <span class="attrib">@param</span> node 
 * <span class="attrib">@return</span> return node's value
 */</span>
<span class="reserved">function</span> getNodeValue(sResult){
  <span class="reserved">if</span>(sResult.nodeType == 1) <span class="reserved">return</span> sResult.firstChild ? sResult.firstChild.nodeValue : <span class="literal">""</span>;
  <span class="reserved">if</span>(sResult.nodeType &lt; 5) <span class="reserved">return</span> sResult.nodeValue;
  <span class="reserved">return</span> sResult;
}

<span class="comment">/**
 * Convenience method that is used to parse dom nodes.
 * <span class="attrib">@param</span> domNode node to find the property in
 * <span class="attrib">@param</span> propertyName string of the property name (including namespace prefix)
 * <span class="attrib">@param</span> defaultValue value to return if property is not found (null by default)
 * <span class="attrib">@return</span> the property value
 */</span>
Mapbuilder.getProperty = <span class="reserved">function</span>(domNode, propertyName, defaultValue) {
  <span class="reserved">if</span> (typeof defaultValue == <span class="literal">"undefined"</span>) {
    defaultValue = null;
  }
  var property = domNode.selectSingleNode(propertyName);
  <span class="reserved">return</span> property ? getNodeValue(property) : defaultValue;
}

<span class="comment">/**
 * Convenience method to parse a string or number as a boolean value
 * <span class="attrib">@param</span> value string (true/false) or number (1/0)
 * <span class="attrib">@return</span> boolean value, default false
 */</span>
Mapbuilder.parseBoolean = <span class="reserved">function</span>(value) {
  var result = false;
  <span class="reserved">if</span> (!value) {
    result = false;
  } <span class="reserved">else</span> <span class="reserved">if</span> (value == 0) {
    result = false;
  } <span class="reserved">else</span> <span class="reserved">if</span> (value == 1) {
      result = true;
  } <span class="reserved">else</span> <span class="reserved">if</span> (value.match(/true/i)) {
    result = true;
  } <span class="reserved">else</span> <span class="reserved">if</span> (value.match(/false/i)){
    <span class="reserved">return</span> false;
  }
  <span class="reserved">return</span> result;
}
</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b><a href='http://mapbuilder.sourceforge.net'>Community Map Builder</a> 27 Apr 2008</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">

</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Sun Apr 27 20:30:54 2008</div>
</body>
</html>
